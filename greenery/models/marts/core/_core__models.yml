version: 2

models:
  - name: dim_products
    description: Dimensional table summarising product data (inventory, lifetime sales, price, etc.)
    columns:
      - name: product_guid
        description: The unique identifier for the product
        tests:
          - not_null
          - unique
      - name: product_name
        description: The human-readable name of the product
      - name: price
        description: The price of the product, as advertised to the customer
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: inventory
        description: Our current inventory for this product
      - name: product_qty_lifetime
        description: The total number of units of this product sold, across its lifetime
        tests:
            - dbt_utils.expression_is_true:
                expression: ">= 0"
      - name: product_sales_lifetime
        description: The total dollar sales of this product, across its lifetime
        tests:
            - dbt_utils.expression_is_true:
                expression: ">= 0"
      - name: product_pageviews_lifetime
        description: The total number of pageviews for this product, across its lifetime
        tests:
            - dbt_utils.expression_is_true:
                expression: ">= 0"
      - name: products_adds_to_cart_lifetime
        description: The total number of times this product has been added to a cart, across its lifetime
        tests:
            - dbt_utils.expression_is_true:
                expression: ">= 0"

  - name: fct_orders
    description: Fact table with order-level data (product & unit count, etc.)
    columns: 
      - name: order_guid
        description: The unique identifier for the order
        tests:
          - not_null
          - unique
      - name: user_guid
        description: The unique identifier for the user who placed the order
        tests:
          - not_null
      - name: status
        description: Status of the order (preparing, shipped, etc)
        tests:
          - accepted_values:
              values: ['preparing', 'shipped', 'delivered']
      - name: address_guid
        tests:
          - not_null
      - name: created_at
        description: Datetime when the order was created
        tests:
          - dbt_utils.expression_is_true:
              expression: "< delivered_at"
      - name: order_cost
        description: The subtotal for the items in the order
        tests:
            - dbt_utils.expression_is_true:
                expression: ">= 0"
            - not_null
      - name: shipping_cost
        description: The cost of shipping, as charged to the customer
        tests:
            - dbt_utils.expression_is_true:
                expression: ">= 0"
            - not_null
      - name: promo_discount
        description: The amount of any promotional discount applied to the order
        tests:
            - dbt_utils.expression_is_true:
                expression: ">= 0"
            - not_null
      - name: order_total
        tests:
            - dbt_utils.expression_is_true:
                expression: ">= 0"
            - not_null
      - name: shipping_service
        description: The shipping service used for the order. Tracking id is available in parent tables.
      - name: estimated_delivery_at
        description: The estimated date and time for delivery of the order
      - name: delivered_at
        description: The date and time when the order was actually delivered
        tests:
          - dbt_utils.expression_is_true:
              expression: "> created_at"
      - name: delivery_delay
        description: The delay (in hours), if any, between the estimated delivery datetime and the actual delivery datetime. Negative values indicate earlier than expected deliveries.
      - name: product_lines
        description: The number of distinct products included in the order
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 1"
      - name: order_units
        description: The total number of units in the order, across all products
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 1"